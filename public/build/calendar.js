function t(){$("#nextWeekButton").click(()=>e(1)),$("#prevWeekButton").click(()=>e(-1)),$("#displayButton").click(r),$("#addButton").click(a),$("#trashButton").click(n),$("#logoutButton").click(d),$("#cancelButton").click(x),$(".color").click(o),$(".columnHeader .fa-chevron-right").click(()=>c(1)),$(".columnHeader .fa-chevron-left").click(()=>c(-1)),$("#allDayCheckBox").change(s)}async function e(t){A+=t,H=E(H,7*t),L=E(L,7*t),await J(),j(),U&&U(),z()}function a(){var t;B==P.VIEW&&(B=P.CREATE,t=b==R.SINGLE_DAY?V:0,T({start:"12:00",end:"13:00",date:D(E(H,t)),title:"",description:"",color:"red",allDay:!1}))}async function n(){if(B==P.VIEW&&window.confirm("This will delete all the events in your calendar!\nThis cannot be undone. Are you sure?"))try{const t=await S.get();t.forEach(t=>{S.doc(t.id).delete(),$("#"+t.id).remove()})}catch(t){window.alert(t.message)}}function o(){$(".color").removeClass("active"),$(this).addClass("active")}function d(){firebase.auth().signOut().then(()=>{window.location.href="./index.html"}).catch(t=>{window.alert(t.message)})}function r(){$("#displayButton").toggleClass("fa-calendar-day").toggleClass("fa-calendar-week"),$("#calendar").toggleClass("singleDay"),(b==R.WEEK?l:i)()}function l(){b=R.SINGLE_DAY,$("#calendar").addClass("singleDay"),$("#displayButton").removeClass("fa-calendar-week").addClass("fa-calendar-day"),$("#displayButton").attr("title","Change to week view"),$(`.day[data-dayIndex="${V}"`).addClass("current"),$(`.columnHeader[data-dayIndex="${V}"`).addClass("current")}function i(){b=R.WEEK,$("#calendar").removeClass("singleDay"),$("#displayButton").removeClass("fa-calendar-day").addClass("fa-calendar-week"),$("#displayButton").attr("title","Change to day view"),$(".day, .columnHeader").removeClass("current")}function c(t){b!=R.WEEK&&($(".day, .columnHeader").removeClass("current"),V+=t,V<0?(e(-1),V=6):7<=V&&(e(1),V=0),$(`.day[data-dayIndex="${V}"`).addClass("current"),$(`.columnHeader[data-dayIndex="${V}"`).addClass("current"))}function s(){$("#timeLabel").toggle(),$("#timeInputs").toggle()}async function u(t){f(t);try{var e=await S.add(t);t.id=e.id,x()}catch(t){$("#errors").text(t.message)}}async function v(t){f(t);try{await S.doc(t.id).update({title:t.title,start:t.start,end:t.end,date:t.date,description:t.description,color:t.color,allDay:t.allDay}),x()}catch(t){$("#errors").text(t.message)}}function f(t){t.title=$("#eventTitle").val(),t.start=$("#eventStart").val(),t.end=$("#eventEnd").val(),t.date=$("#eventDate").val(),t.description=$("#eventDescription").val(),t.allDay=$("#allDayCheckBox").prop("checked"),t.color=$(".color.active").attr("data-color")}async function y(t){if(window.confirm("Do you really want to delete this event?"))try{await S.doc(t.id).delete(),$("#"+t.id).remove(),x()}catch(t){$("#errors").text(t.message)}}function h(t){B==P.UPDATE&&(x(),B=P.CREATE,T({title:"Copy of "+t.title,start:t.start,end:t.end,date:t.date,description:t.description,color:t.color,allDay:t.allDay}))}function m(e){if(e.date<D(H)||e.date>D(L))$("#"+e.id).remove();else{let t;t=$("#"+e.id).length?$("#"+e.id):$("<div></div>").addClass("event").attr("id",e.id).click(()=>p(e));var a,n,o,d,r,l=W,i=C(new Date(e.date));e.allDay?t.addClass("allDay").text(e.title).css("backgroundColor",`var(--color-${e.color})`).appendTo(`.columnHeader[data-dayIndex=${i}] .allDaySection`):(a=parseInt(e.start.substring(0,2)),n=parseInt(e.end.substring(0,2)),o=parseInt(e.start.substring(3,5)),d=parseInt(e.end.substring(3,5)),r=(new Date(e.date+"T"+e.end).getTime()-new Date(e.date+"T"+e.start).getTime())/6e4,t.removeClass("allDay").text(e.title).css("top",(a+o/60)*l+1+"px").css("bottom",24*l-(n+d/60)*l+2+"px").css("backgroundColor",`var(--color-${e.color})`).appendTo(`.day[data-dayIndex=${i}]`),r<45?t.removeClass("shortEvent").addClass("veryShortEvent"):r<59?t.removeClass("veryShortEvent").addClass("shortEvent"):t.removeClass("shortEvent").removeClass("veryShortEvent"))}}function p(t){B==P.VIEW&&(B=P.UPDATE,T(t))}async function g(n){if(n.allDay)return!0;const o=$("#eventStart").val(),d=$("#eventEnd").val();var t=$("#eventDate").val();if(o!=n.start||d!=n.end||t!=n.date){const e=await S.where("date","==",t).get();let a=null;if(e.forEach(t=>{var e=t.id,t=t.data();!t.allDay&&e!=n.id&&t.end>o&&t.start<d&&(a=t)}),a)return $("#errors").text(`This collides with the event '${a.title}'`+`(${a.start} - ${a.end}).`),!1}t=(new Date(t+"T"+d).getTime()-new Date(t+"T"+o).getTime())/6e4;return t<0?($("#errors").text("The start cannot be after the end."),!1):!(t<30)||($("#errors").text("Events should be at least 30 minutes."),!1)}function D(t){return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-`+t.getDate().toString().padStart(2,"0")}function C(t){t=t.getDay();return 0==t?6:t-1}const w=864e5;function E(t,e){return new Date(t.getTime()+e*w)}function T(e){$("#modalTitle").text(B==P.UPDATE?"Update your event":"Create a new event"),$("#eventTitle").val(e.title),$("#eventDate").val(e.date),$("#eventStart").val(e.start),$("#eventEnd").val(e.end),$("#eventDescription").val(e.description),$("#allDayCheckBox").prop("checked",e.allDay),e.allDay?$("#timeLabel, #timeInputs").hide():$("#timeLabel, #timeInputs").show(),$(".color").removeClass("active"),$(`.color[data-color=${e.color}]`).addClass("active"),B==P.UPDATE?($("#submitButton").val("Update"),$("#deleteButton").show().off("click").click(()=>y(e)),$("#copyButton").show().off("click").click(()=>h(e))):B==P.CREATE&&($("#submitButton").val("Create"),$("#deleteButton, #copyButton").hide()),$("#modalContainer").fadeIn(200).css("display","flex"),$("#eventModal").off("submit").submit(t=>{t.preventDefault(),k(e)})}function x(){$("#modalContainer").fadeOut(200),$("#errors").text(""),B=P.VIEW}async function k(t){await g(t)&&(B==P.CREATE?await u(t):B==P.UPDATE&&await v(t))}let I,S,B,b,A,W,H,L,U,V;const P={VIEW:1,UPDATE:2,CREATE:3},R={SINGLE_DAY:1,WEEK:2};function K(){Y(),G(),N(),_(),M(),F(),j(),z(),t()}function Y(){S=database.collection(I.uid),B=P.VIEW,b=R.WEEK,A=0,W=30,H=null,L=null,U=null,V=C(new Date)}function G(){window.innerWidth<900&&l(),$("#calendar").fadeIn()}function N(){$("#emailDisplay").text(I.email)}function _(){for(let t=0;t<24;t++){var e=$("<div></div>").attr("data-hour",t).addClass("time").appendTo(".dayTime");0<t&&$("<span></span>").text(t+":00").appendTo(e)}$("#calendar").scrollTop(7*W)}function M(){$(".day").each(function(){const e=$(this),a=parseInt(e.attr("data-dayIndex"));$("<div></div>").addClass("allDaySection").appendTo(e);for(let t=0;t<24;t++)$("<div></div>").attr("data-hour",t).appendTo(e).addClass("slot").on("click",()=>O(t,a)).hover(()=>$(`.time[data-hour=${t}]`).addClass("currentTime"),()=>$(".time").removeClass("currentTime"))})}function O(t,e){B==P.VIEW&&(B=P.CREATE,T({start:t.toString().padStart(2,"0")+":00",end:t<23?(t+1).toString().padStart(2,"0")+":00":t.toString().padStart(2,"0")+":59",date:D(E(H,e)),title:"",description:"",color:"red",allDay:!1}))}function F(){var t=new Date;H=E(t,-C(t)),L=E(H,6)}function j(){var t={month:"2-digit",day:"2-digit",year:"numeric"};$("#weekStartDisplay").text(H.toLocaleDateString(void 0,t)),$("#weekEndDisplay").text(L.toLocaleDateString(void 0,t));for(let t=0;t<7;t++){const a=E(H,t);var e=a.toLocaleDateString(void 0,{month:"2-digit",day:"2-digit"});$(`.columnHeader[data-dayIndex=${t}] .date`).text(e)}0==A?q(!0):q(!1)}function q(t){t?(t=C(new Date),$(`.columnHeader[data-dayIndex=${t}]`).addClass("today")):$(".columnHeader").removeClass("today")}function z(){U=S.where("date",">=",D(H)).where("date","<=",D(L)).onSnapshot(t=>{$(".event").remove(),t.forEach(t=>{const e=t.data();e.id=t.id,m(e)})})}async function J(){const a=[],t=await S.where("date",">=",D(H)).where("date","<=",D(L)).get();t.forEach(t=>{const e=t.data();e.id=t.id,a.push(e)}),$(".event").remove();for(const e of a)m(e)}$(()=>{firebase.auth().onAuthStateChanged(t=>{t&&t.emailVerified?(I=t,K()):window.location.href="./index.html"})});
//# sourceMappingURL=calendar.js.map
