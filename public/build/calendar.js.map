{"version":3,"sources":["Calendar.js","helper.js"],"names":["firebase","auth","onAuthStateChanged","user","Calendar","setup","window","location","href","MODE","VIEW","UPDATE","CREATE","DISPLAY","DAY","WEEK","constructor","this","collection","db","uid","mode","display","weekOffset","slotHeight","weekStart","weekEnd","listener","currentDayIndex","getDayIndex","Date","detectDisplay","showEmail","setupTimes","setupDays","calculateCurrentWeek","showWeek","setupControls","listenForUpdates","innerWidth","switchToDayDisplay","$","fadeIn","text","email","let","hour","time","attr","addClass","appendTo","scrollTop","cal","each","day","dayIndex","parseInt","on","clickSlot","hover","hoverOver","hoverOut","changeDay","direction","removeClass","changeWeek","now","addDays","options","month","year","toLocaleDateString","undefined","date","showCurrentDay","hideCurrentDay","click","addNewEvent","trash","closeModal","changeColor","logout","toggleDisplay","change","toggleTimes","toggle","signOut","then","catch","alert","error","message","toggleClass","switchToWeekDisplay","number","start","toString","padStart","end","dateString","openModal","title","description","color","allDay","event","val","prop","hide","show","off","delete","copy","css","submit","e","preventDefault","submitModal","fadeOut","validate","create","update","read","eventRef","add","id","doc","confirm","remove","where","onSnapshot","snap","forEach","data","eventSlot","length","startHour","endHour","startMinutes","endMinutes","duration","h","substring","getTime","newStart","newEnd","newDate","eventsOnNewDate","get","collidingEvent","otherId","other","getFullYear","getMonth","getDate","falseIndex","getDay","dayInMillis"],"mappings":"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","file":"calendar.js","sourcesContent":["firebase.auth().onAuthStateChanged((user) => {\r\n    if (!user) {\r\n        window.location.href = \"./index.html\";\r\n    } else {\r\n        new Calendar(user).setup();\r\n    }\r\n});\r\n\r\nconst MODE = {\r\n    VIEW: 1,\r\n    UPDATE: 2,\r\n    CREATE: 3,\r\n};\r\n\r\nconst DISPLAY = {\r\n    DAY: 1,\r\n    WEEK: 2,\r\n};\r\n\r\nclass Calendar {\r\n    constructor(user) {\r\n        this.user = user;\r\n        this.collection = db.collection(this.user.uid);\r\n        this.mode = MODE.VIEW;\r\n        this.display = DISPLAY.WEEK;\r\n        this.weekOffset = 0;\r\n        this.slotHeight = 30;\r\n        this.weekStart = null;\r\n        this.weekEnd = null;\r\n        this.listener = null;\r\n        this.currentDayIndex = getDayIndex(new Date());\r\n    }\r\n\r\n    setup() {\r\n        this.detectDisplay();\r\n        this.showEmail();\r\n        this.setupTimes();\r\n        this.setupDays();\r\n        this.calculateCurrentWeek();\r\n        this.showWeek();\r\n        this.setupControls();\r\n        this.listenForUpdates();\r\n    }\r\n\r\n    detectDisplay() {\r\n        if (window.innerWidth < 900) {\r\n            this.switchToDayDisplay();\r\n        }\r\n        $(\"#calendar\").fadeIn();\r\n    }\r\n\r\n    showEmail() {\r\n        $(\"#emailDisplay\").text(this.user.email);\r\n    }\r\n\r\n    setupTimes() {\r\n        for (let hour = 0; hour < 24; hour++) {\r\n            const time = $(\"<div></div>\")\r\n                .attr(\"data-hour\", hour)\r\n                .addClass(\"time\")\r\n                .appendTo(\".dayTime\");\r\n            if (hour > 0)\r\n                $(\"<span></span>\").text(`${hour}:00`).appendTo(time);\r\n        }\r\n        $(\"#calendar\").scrollTop(7 * this.slotHeight);\r\n    }\r\n\r\n    setupDays() {\r\n        const cal = this;\r\n        $(\".day\").each(function () {\r\n            const day = $(this);\r\n            const dayIndex = parseInt(day.attr(\"data-dayIndex\"));\r\n            $(\"<div></div>\").addClass(\"allDaySection\").appendTo(day);\r\n            for (let hour = 0; hour < 24; hour++) {\r\n                $(\"<div></div>\")\r\n                    .attr(\"data-hour\", hour)\r\n                    .appendTo(day)\r\n                    .addClass(\"slot\")\r\n                    .on(\"click\", () => cal.clickSlot(hour, dayIndex))\r\n                    .hover(\r\n                        () => cal.hoverOver(hour),\r\n                        () => cal.hoverOut()\r\n                    );\r\n            }\r\n        });\r\n    }\r\n\r\n    changeDay(direction) {\r\n        if (this.display == DISPLAY.WEEK) return;\r\n        $(\".day, .columnHeader\").removeClass(\"current\");\r\n        this.currentDayIndex += direction;\r\n        if (this.currentDayIndex < 0) {\r\n            this.changeWeek(-1);\r\n            this.currentDayIndex = 6;\r\n        } else if (this.currentDayIndex >= 7) {\r\n            this.changeWeek(+1);\r\n            this.currentDayIndex = 0;\r\n        }\r\n        $(`.day[data-dayIndex=\"${this.currentDayIndex}\"`).addClass(\r\n            \"current\"\r\n        );\r\n        $(\r\n            `.columnHeader[data-dayIndex=\"${this.currentDayIndex}\"`\r\n        ).addClass(\"current\");\r\n    }\r\n\r\n    calculateCurrentWeek() {\r\n        const now = new Date();\r\n        this.weekStart = addDays(now, -getDayIndex(now));\r\n        this.weekEnd = addDays(this.weekStart, 6);\r\n    }\r\n\r\n    showWeek() {\r\n        const options = {\r\n            month: \"2-digit\",\r\n            day: \"2-digit\",\r\n            year: \"numeric\",\r\n        };\r\n        $(\"#weekStartDisplay\").text(\r\n            this.weekStart.toLocaleDateString(undefined, options)\r\n        );\r\n        $(\"#weekEndDisplay\").text(\r\n            this.weekEnd.toLocaleDateString(undefined, options)\r\n        );\r\n\r\n        for (let dayIndex = 0; dayIndex < 7; dayIndex++) {\r\n            const date = addDays(this.weekStart, dayIndex);\r\n            const display = date.toLocaleDateString(undefined, {\r\n                month: \"2-digit\",\r\n                day: \"2-digit\",\r\n            });\r\n            $(`.columnHeader[data-dayIndex=${dayIndex}] .date`).text(\r\n                display\r\n            );\r\n        }\r\n        if (this.weekOffset == 0) {\r\n            this.showCurrentDay();\r\n        } else {\r\n            this.hideCurrentDay();\r\n        }\r\n    }\r\n\r\n    setupControls() {\r\n        $(\"#nextWeekBtn\").click(() => this.changeWeek(1));\r\n        $(\"#prevWeekBtn\").click(() => this.changeWeek(-1));\r\n        $(\"#addButton\").click(() => this.addNewEvent());\r\n        $(\"#trashButton\").click(() => this.trash());\r\n        $(\"#cancelButton\").click(() => this.closeModal());\r\n        $(\".color\").click(this.changeColor);\r\n        $(\"#logoutButton\").click(() => this.logout());\r\n        $(\"#displayButton\").click(() => this.toggleDisplay());\r\n        $(\".columnHeader .fa-chevron-right\").click(() =>\r\n            this.changeDay(+1)\r\n        );\r\n        $(\".columnHeader .fa-chevron-left\").click(() =>\r\n            this.changeDay(-1)\r\n        );\r\n        $(\"#allDayCheckBox\").change(() => this.toggleTimes());\r\n    }\r\n\r\n    toggleTimes() {\r\n        $(\"#timeLabel\").toggle();\r\n        $(\"#timeInputs\").toggle();\r\n    }\r\n\r\n    logout() {\r\n        firebase\r\n            .auth()\r\n            .signOut()\r\n            .then(() => {\r\n                window.location.href = \"./index.html\";\r\n            })\r\n            .catch((error) => {\r\n                window.alert(error.message);\r\n            });\r\n    }\r\n\r\n    toggleDisplay() {\r\n        $(\"#displayButton\")\r\n            .toggleClass(\"fa-calendar-day\")\r\n            .toggleClass(\"fa-calendar-week\");\r\n        $(\"#calendar\").toggleClass(\"singleDay\");\r\n        if (this.display == DISPLAY.WEEK) {\r\n            this.switchToDayDisplay();\r\n        } else {\r\n            this.switchToWeekDisplay();\r\n        }\r\n    }\r\n\r\n    switchToDayDisplay() {\r\n        this.display = DISPLAY.DAY;\r\n        $(\"#calendar\").addClass(\"singleDay\");\r\n        $(\"#displayButton\")\r\n            .removeClass(\"fa-calendar-week\")\r\n            .addClass(\"fa-calendar-day\");\r\n        $(\"#displayButton\").attr(\"title\", \"Change to week view\");\r\n        $(`.day[data-dayIndex=\"${this.currentDayIndex}\"`).addClass(\r\n            \"current\"\r\n        );\r\n        $(\r\n            `.columnHeader[data-dayIndex=\"${this.currentDayIndex}\"`\r\n        ).addClass(\"current\");\r\n    }\r\n\r\n    switchToWeekDisplay() {\r\n        this.display = DISPLAY.WEEK;\r\n        $(\"#calendar\").removeClass(\"singleDay\");\r\n        $(\"#displayButton\")\r\n            .removeClass(\"fa-calendar-day\")\r\n            .addClass(\"fa-calendar-week\");\r\n\r\n        $(\"#displayButton\").attr(\"title\", \"Change to day view\");\r\n        $(\".day, .columnHeader\").removeClass(\"current\");\r\n    }\r\n\r\n    changeWeek(number) {\r\n        this.weekOffset += number;\r\n        this.weekStart = addDays(this.weekStart, 7 * number);\r\n        this.weekEnd = addDays(this.weekEnd, 7 * number);\r\n        this.showWeek();\r\n        if (this.listener) this.listener();\r\n        this.listenForUpdates();\r\n    }\r\n\r\n    showCurrentDay() {\r\n        const now = new Date();\r\n        const dayIndex = getDayIndex(now);\r\n        $(`.columnHeader[data-dayIndex=${dayIndex}]`).addClass(\r\n            \"currentDay\"\r\n        );\r\n    }\r\n\r\n    hideCurrentDay() {\r\n        $(\".columnHeader\").removeClass(\"currentDay\");\r\n    }\r\n\r\n    hoverOver(hour) {\r\n        $(`.time[data-hour=${hour}]`).addClass(\"currentTime\");\r\n    }\r\n\r\n    hoverOut() {\r\n        $(\".time\").removeClass(\"currentTime\");\r\n    }\r\n\r\n    clickSlot(hour, dayIndex) {\r\n        if (this.mode != MODE.VIEW) return;\r\n        this.mode = MODE.CREATE;\r\n        const start = hour.toString().padStart(2, \"0\") + \":00\";\r\n        const end =\r\n            hour < 23\r\n                ? (hour + 1).toString().padStart(2, \"0\") + \":00\"\r\n                : hour.toString().padStart(2, \"0\") + \":59\";\r\n\r\n        const date = dateString(addDays(this.weekStart, dayIndex));\r\n        const event = {\r\n            start,\r\n            end,\r\n            date,\r\n            title: \"\",\r\n            description: \"\",\r\n            color: \"red\",\r\n            allDay: false,\r\n        };\r\n        this.openModal(event);\r\n    }\r\n\r\n    changeColor() {\r\n        $(\".color\").removeClass(\"active\");\r\n        $(this).addClass(\"active\");\r\n    }\r\n\r\n    openModal(event) {\r\n        $(\"#modalTitle\").text(\r\n            this.mode == MODE.UPDATE\r\n                ? \"Update your event\"\r\n                : \"Create a new event\"\r\n        );\r\n        $(\"#eventTitle\").val(event.title);\r\n        $(\"#eventDate\").val(event.date);\r\n        $(\"#eventStart\").val(event.start);\r\n        $(\"#eventEnd\").val(event.end);\r\n        $(\"#eventDescription\").val(event.description);\r\n        $(\"#allDayCheckBox\").prop(\"checked\", event.allDay);\r\n        if (event.allDay) {\r\n            $(\"#timeLabel, #timeInputs\").hide();\r\n        } else {\r\n            $(\"#timeLabel, #timeInputs\").show();\r\n        }\r\n        $(\".color\").removeClass(\"active\");\r\n        $(`.color[data-color=${event.color}]`).addClass(\"active\");\r\n        if (this.mode == MODE.UPDATE) {\r\n            $(\"#submitButton\").val(\"Update\");\r\n            $(\"#deleteButton\")\r\n                .show()\r\n                .off(\"click\")\r\n                .click(() => this.delete(event));\r\n            $(\"#copyButton\")\r\n                .show()\r\n                .off(\"click\")\r\n                .click(() => this.copy(event));\r\n        } else if (this.mode == MODE.CREATE) {\r\n            $(\"#submitButton\").val(\"Create\");\r\n            $(\"#deleteButton, #copyButton\").hide();\r\n        }\r\n        $(\"#modalContainer\").fadeIn(200).css(\"display\", \"flex\");\r\n        $(\"#eventModal\")\r\n            .off(\"submit\")\r\n            .submit((e) => {\r\n                e.preventDefault();\r\n                this.submitModal(event);\r\n            });\r\n    }\r\n\r\n    closeModal() {\r\n        $(\"#modalContainer\").fadeOut(200);\r\n        $(\"#errors\").text(\"\");\r\n        this.mode = MODE.VIEW;\r\n    }\r\n\r\n    async submitModal(event) {\r\n        const isValid = await this.validate(event);\r\n        if (!isValid) return;\r\n        if (this.mode == MODE.CREATE) {\r\n            await this.create(event);\r\n        } else if (this.mode == MODE.UPDATE) {\r\n            await this.update(event);\r\n        }\r\n    }\r\n\r\n    async create(event) {\r\n        this.read(event);\r\n        try {\r\n            const eventRef = await this.collection.add(event);\r\n            event.id = eventRef.id;\r\n            this.closeModal();\r\n        } catch (error) {\r\n            $(\"#errors\").text(error.message);\r\n        }\r\n    }\r\n\r\n    async update(event) {\r\n        this.read(event);\r\n        try {\r\n            await this.collection.doc(event.id).update({\r\n                title: event.title,\r\n                start: event.start,\r\n                end: event.end,\r\n                date: event.date,\r\n                description: event.description,\r\n                color: event.color,\r\n                allDay: event.allDay,\r\n            });\r\n            this.closeModal();\r\n        } catch (error) {\r\n            $(\"#errors\").text(error.message);\r\n        }\r\n    }\r\n\r\n    read(event) {\r\n        event.title = $(\"#eventTitle\").val();\r\n        event.start = $(\"#eventStart\").val();\r\n        event.end = $(\"#eventEnd\").val();\r\n        event.date = $(\"#eventDate\").val();\r\n        event.description = $(\"#eventDescription\").val();\r\n        event.allDay = $(\"#allDayCheckBox\").prop(\"checked\");\r\n        event.color = $(\".color.active\").attr(\"data-color\");\r\n    }\r\n\r\n    async delete(event) {\r\n        if (\r\n            window.confirm(\"Do you really want to delete this event?\")\r\n        ) {\r\n            try {\r\n                await this.collection.doc(event.id).delete();\r\n                $(`#${event.id}`).remove();\r\n                this.closeModal();\r\n            } catch (error) {\r\n                $(\"#errors\").text(error.message);\r\n            }\r\n        }\r\n    }\r\n\r\n    copy(event) {\r\n        if (this.mode != MODE.UPDATE) return;\r\n        this.closeModal();\r\n        this.mode = MODE.CREATE;\r\n        const copy = {\r\n            title: \"Copy of \" + event.title,\r\n            start: event.start,\r\n            end: event.end,\r\n            date: event.date,\r\n            description: event.description,\r\n            color: event.color,\r\n            allDay: event.allDay,\r\n        };\r\n        this.openModal(copy);\r\n    }\r\n\r\n    addNewEvent() {\r\n        if (this.mode != MODE.VIEW) return;\r\n        this.mode = MODE.CREATE;\r\n        const dayIndex =\r\n            this.display == DISPLAY.DAY ? this.currentDayIndex : 0;\r\n        const event = {\r\n            start: \"12:00\",\r\n            end: \"13:00\",\r\n            date: dateString(addDays(this.weekStart, dayIndex)),\r\n            title: \"\",\r\n            description: \"\",\r\n            color: \"red\",\r\n            allDay: false,\r\n        };\r\n        this.openModal(event);\r\n    }\r\n\r\n    listenForUpdates() {\r\n        this.listener = this.collection\r\n            .where(\"date\", \">=\", dateString(this.weekStart))\r\n            .where(\"date\", \"<=\", dateString(this.weekEnd))\r\n            .onSnapshot((snap) => {\r\n                $(\".event\").remove();\r\n                snap.forEach((doc) => {\r\n                    const event = doc.data();\r\n                    event.id = doc.id;\r\n                    this.show(event);\r\n                });\r\n            });\r\n    }\r\n\r\n    show(event) {\r\n        if (\r\n            event.date < dateString(this.weekStart) ||\r\n            event.date > dateString(this.weekEnd)\r\n        ) {\r\n            $(`#${event.id}`).remove();\r\n            return;\r\n        }\r\n\r\n        let eventSlot;\r\n\r\n        if ($(`#${event.id}`).length) {\r\n            eventSlot = $(`#${event.id}`);\r\n        } else {\r\n            eventSlot = $(\"<div></div>\")\r\n                .addClass(\"event\")\r\n                .attr(\"id\", event.id)\r\n                .click(() => this.click(event));\r\n        }\r\n\r\n        const h = this.slotHeight;\r\n        const dayIndex = getDayIndex(new Date(event.date));\r\n\r\n        if (!event.allDay) {\r\n            const startHour = parseInt(event.start.substring(0, 2));\r\n            const endHour = parseInt(event.end.substring(0, 2));\r\n            const startMinutes = parseInt(\r\n                event.start.substring(3, 5)\r\n            );\r\n            const endMinutes = parseInt(event.end.substring(3, 5));\r\n\r\n            const duration =\r\n                (new Date(`${event.date}T${event.end}`).getTime() -\r\n                    new Date(\r\n                        `${event.date}T${event.start}`\r\n                    ).getTime()) /\r\n                (1000 * 60);\r\n\r\n            eventSlot\r\n                .removeClass(\"allDay\")\r\n                .text(event.title)\r\n                .css(\r\n                    \"top\",\r\n                    (startHour + startMinutes / 60) * h + 1 + \"px\"\r\n                )\r\n                .css(\r\n                    \"bottom\",\r\n                    24 * h -\r\n                        (endHour + endMinutes / 60) * h +\r\n                        2 +\r\n                        \"px\"\r\n                )\r\n                .css(\"backgroundColor\", `var(--color-${event.color})`)\r\n                .appendTo(`.day[data-dayIndex=${dayIndex}]`);\r\n\r\n            if (duration < 45) {\r\n                eventSlot\r\n                    .removeClass(\"shortEvent\")\r\n                    .addClass(\"veryShortEvent\");\r\n            } else if (duration < 59) {\r\n                eventSlot\r\n                    .removeClass(\"veryShortEvent\")\r\n                    .addClass(\"shortEvent\");\r\n            } else {\r\n                eventSlot\r\n                    .removeClass(\"shortEvent\")\r\n                    .removeClass(\"veryShortEvent\");\r\n            }\r\n        } else {\r\n            eventSlot\r\n                .addClass(\"allDay\")\r\n                .text(event.title)\r\n                .css(\"backgroundColor\", `var(--color-${event.color})`)\r\n                .appendTo(\r\n                    `.columnHeader[data-dayIndex=${dayIndex}] .allDaySection`\r\n                );\r\n        }\r\n    }\r\n\r\n    click(event) {\r\n        if (this.mode != MODE.VIEW) return;\r\n        this.mode = MODE.UPDATE;\r\n        this.openModal(event);\r\n    }\r\n\r\n    async validate(event) {\r\n        if (event.allDay) return true;\r\n        const newStart = $(\"#eventStart\").val();\r\n        const newEnd = $(\"#eventEnd\").val();\r\n        const newDate = $(\"#eventDate\").val();\r\n        const changedTime =\r\n            newStart != event.start ||\r\n            newEnd != event.end ||\r\n            newDate != event.date;\r\n\r\n        if (changedTime) {\r\n            const eventsOnNewDate = await this.collection\r\n                .where(\"date\", \"==\", newDate)\r\n                .get();\r\n\r\n            let collidingEvent = null;\r\n\r\n            eventsOnNewDate.forEach((doc) => {\r\n                const otherId = doc.id;\r\n                const other = doc.data();\r\n                if (\r\n                    !other.allDay &&\r\n                    otherId != event.id &&\r\n                    other.end > newStart &&\r\n                    other.start < newEnd\r\n                ) {\r\n                    collidingEvent = other;\r\n                }\r\n            });\r\n            if (collidingEvent) {\r\n                $(\"#errors\").text(\r\n                    `This collides with the event '${collidingEvent.title}'` +\r\n                        `(${collidingEvent.start} - ${collidingEvent.end}).`\r\n                );\r\n                return false;\r\n            }\r\n        }\r\n\r\n        const duration =\r\n            (new Date(`${newDate}T${newEnd}`).getTime() -\r\n                new Date(`${newDate}T${newStart}`).getTime()) /\r\n            (1000 * 60);\r\n\r\n        if (duration < 0) {\r\n            $(\"#errors\").text(\"The start cannot be after the end.\");\r\n            return false;\r\n        } else if (duration < 30) {\r\n            $(\"#errors\").text(\r\n                \"Events should be at least 30 minutes.\"\r\n            );\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    async trash() {\r\n        if (this.mode != MODE.VIEW) return;\r\n        const confirmed = window.confirm(\r\n            \"This will delete all the events in your calendar!\\n\" +\r\n                \"This cannot be undone. Are you sure?\"\r\n        );\r\n        if (confirmed) {\r\n            try {\r\n                const snap = await this.collection.get();\r\n                snap.forEach((doc) => {\r\n                    this.collection.doc(doc.id).delete();\r\n                    $(`#${doc.id}`).remove();\r\n                });\r\n            } catch (error) {\r\n                window.alert(error.message);\r\n            }\r\n        }\r\n    }\r\n}\r\n","function dateString(date) {\r\n    return `${date.getFullYear()}-${(date.getMonth() + 1)\r\n        .toString()\r\n        .padStart(2, \"0\")}-${date\r\n        .getDate()\r\n        .toString()\r\n        .padStart(2, \"0\")}`;\r\n}\r\n\r\nfunction getDayIndex(date) {\r\n    const falseIndex = date.getDay();\r\n    return falseIndex == 0 ? 6 : falseIndex - 1;\r\n}\r\n\r\nconst dayInMillis = 1000 * 60 * 60 * 24;\r\n\r\nfunction addDays(date, number) {\r\n    return new Date(date.getTime() + number * dayInMillis);\r\n}\r\n"]}