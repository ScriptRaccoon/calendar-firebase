{"version":3,"sources":["controls.js","event.js","helper.js","modal.js","setup.js"],"names":["setupControls","$","click","changeWeek","toggleDisplay","addNewEvent","trashCalendar","logout","closeModal","changeColor","changeDay","change","toggleTimes","number","weekOffset","weekStart","addDays","weekEnd","showWeek","listener","listenForUpdates","dayIndex","mode","MODE","VIEW","CREATE","display","DISPLAY","DAY","currentDayIndex","openModal","start","end","date","dateString","title","description","color","allDay","async","window","confirm","snap","collection","get","forEach","doc","id","delete","remove","error","alert","message","removeClass","this","addClass","firebase","auth","signOut","then","location","href","catch","toggleClass","WEEK","switchToDayDisplay","switchToWeekDisplay","attr","direction","toggle","createEvent","event","readEvent","eventRef","add","text","updateEvent","update","val","prop","deleteEvent","copyEvent","UPDATE","showEvent","let","eventElement","length","clickEvent","startHour","endHour","startMinutes","endMinutes","duration","h","slotHeight","getDayIndex","Date","css","appendTo","parseInt","substring","getTime","validateEvent","newStart","newEnd","newDate","eventsOnNewDate","where","collidingEvent","otherId","other","data","getFullYear","getMonth","toString","padStart","getDate","falseIndex","getDay","dayInMillis","hide","show","off","fadeIn","submit","e","preventDefault","submitModal","fadeOut","user","setupCalendar","setupVariables","detectDisplay","showEmail","setupTimes","setupDays","calculateCurrentWeek","database","uid","innerWidth","email","hour","time","scrollTop","each","day","on","handleClick","hover","now","options","month","year","toLocaleDateString","undefined","showCurrentDay","hideCurrentDay","onSnapshot","onAuthStateChanged","firebaseUser","emailVerified"],"mappings":"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","file":"calendar.js","sourcesContent":["function setupControls() {\r\n    $(\"#nextWeekBtn\").click(() => changeWeek(1));\r\n    $(\"#prevWeekBtn\").click(() => changeWeek(-1));\r\n    $(\"#displayButton\").click(toggleDisplay);\r\n    $(\"#addButton\").click(addNewEvent);\r\n    $(\"#trashButton\").click(trashCalendar);\r\n    $(\"#logoutButton\").click(logout);\r\n    $(\"#cancelButton\").click(closeModal);\r\n    $(\".color\").click(changeColor);\r\n    $(\".columnHeader .fa-chevron-right\").click(() => changeDay(+1));\r\n    $(\".columnHeader .fa-chevron-left\").click(() => changeDay(-1));\r\n    $(\"#allDayCheckBox\").change(toggleTimes);\r\n}\r\n\r\nfunction changeWeek(number) {\r\n    weekOffset += number;\r\n    weekStart = addDays(weekStart, 7 * number);\r\n    weekEnd = addDays(weekEnd, 7 * number);\r\n    showWeek();\r\n    if (listener) listener();\r\n    listenForUpdates();\r\n}\r\n\r\nfunction addNewEvent() {\r\n    if (mode != MODE.VIEW) return;\r\n    mode = MODE.CREATE;\r\n    const dayIndex = display == DISPLAY.DAY ? currentDayIndex : 0;\r\n    const event = {\r\n        start: \"12:00\",\r\n        end: \"13:00\",\r\n        date: dateString(addDays(weekStart, dayIndex)),\r\n        title: \"\",\r\n        description: \"\",\r\n        color: \"red\",\r\n        allDay: false,\r\n    };\r\n    openModal(event);\r\n}\r\n\r\nasync function trashCalendar() {\r\n    if (mode != MODE.VIEW) return;\r\n    const confirmed = window.confirm(\r\n        \"This will delete all the events in your calendar!\\n\" +\r\n            \"This cannot be undone. Are you sure?\"\r\n    );\r\n    if (confirmed) {\r\n        try {\r\n            const snap = await collection.get();\r\n            snap.forEach((doc) => {\r\n                collection.doc(doc.id).delete();\r\n                $(`#${doc.id}`).remove();\r\n            });\r\n        } catch (error) {\r\n            window.alert(error.message);\r\n        }\r\n    }\r\n}\r\n\r\nfunction changeColor() {\r\n    $(\".color\").removeClass(\"active\");\r\n    $(this).addClass(\"active\");\r\n}\r\n\r\nfunction logout() {\r\n    firebase\r\n        .auth()\r\n        .signOut()\r\n        .then(() => {\r\n            window.location.href = \"./index.html\";\r\n        })\r\n        .catch((error) => {\r\n            window.alert(error.message);\r\n        });\r\n}\r\n\r\nfunction toggleDisplay() {\r\n    $(\"#displayButton\")\r\n        .toggleClass(\"fa-calendar-day\")\r\n        .toggleClass(\"fa-calendar-week\");\r\n    $(\"#calendar\").toggleClass(\"singleDay\");\r\n    if (display == DISPLAY.WEEK) {\r\n        switchToDayDisplay();\r\n    } else {\r\n        switchToWeekDisplay();\r\n    }\r\n}\r\n\r\nfunction switchToDayDisplay() {\r\n    display = DISPLAY.DAY;\r\n    $(\"#calendar\").addClass(\"singleDay\");\r\n    $(\"#displayButton\")\r\n        .removeClass(\"fa-calendar-week\")\r\n        .addClass(\"fa-calendar-day\");\r\n    $(\"#displayButton\").attr(\"title\", \"Change to week view\");\r\n    $(`.day[data-dayIndex=\"${currentDayIndex}\"`).addClass(\"current\");\r\n    $(`.columnHeader[data-dayIndex=\"${currentDayIndex}\"`).addClass(\r\n        \"current\"\r\n    );\r\n}\r\n\r\nfunction switchToWeekDisplay() {\r\n    display = DISPLAY.WEEK;\r\n    $(\"#calendar\").removeClass(\"singleDay\");\r\n    $(\"#displayButton\")\r\n        .removeClass(\"fa-calendar-day\")\r\n        .addClass(\"fa-calendar-week\");\r\n\r\n    $(\"#displayButton\").attr(\"title\", \"Change to day view\");\r\n    $(\".day, .columnHeader\").removeClass(\"current\");\r\n}\r\n\r\nfunction changeDay(direction) {\r\n    if (display == DISPLAY.WEEK) return;\r\n    $(\".day, .columnHeader\").removeClass(\"current\");\r\n    currentDayIndex += direction;\r\n    if (currentDayIndex < 0) {\r\n        changeWeek(-1);\r\n        currentDayIndex = 6;\r\n    } else if (currentDayIndex >= 7) {\r\n        changeWeek(+1);\r\n        currentDayIndex = 0;\r\n    }\r\n    $(`.day[data-dayIndex=\"${currentDayIndex}\"`).addClass(\"current\");\r\n    $(`.columnHeader[data-dayIndex=\"${currentDayIndex}\"`).addClass(\r\n        \"current\"\r\n    );\r\n}\r\n\r\nfunction toggleTimes() {\r\n    $(\"#timeLabel\").toggle();\r\n    $(\"#timeInputs\").toggle();\r\n}\r\n","async function createEvent(event) {\r\n    readEvent(event);\r\n    try {\r\n        const eventRef = await collection.add(event);\r\n        event.id = eventRef.id;\r\n        closeModal();\r\n    } catch (error) {\r\n        $(\"#errors\").text(error.message);\r\n    }\r\n}\r\n\r\nasync function updateEvent(event) {\r\n    readEvent(event);\r\n    try {\r\n        await collection.doc(event.id).update({\r\n            title: event.title,\r\n            start: event.start,\r\n            end: event.end,\r\n            date: event.date,\r\n            description: event.description,\r\n            color: event.color,\r\n            allDay: event.allDay,\r\n        });\r\n        closeModal();\r\n    } catch (error) {\r\n        $(\"#errors\").text(error.message);\r\n    }\r\n}\r\n\r\nfunction readEvent(event) {\r\n    event.title = $(\"#eventTitle\").val();\r\n    event.start = $(\"#eventStart\").val();\r\n    event.end = $(\"#eventEnd\").val();\r\n    event.date = $(\"#eventDate\").val();\r\n    event.description = $(\"#eventDescription\").val();\r\n    event.allDay = $(\"#allDayCheckBox\").prop(\"checked\");\r\n    event.color = $(\".color.active\").attr(\"data-color\");\r\n}\r\n\r\nasync function deleteEvent(event) {\r\n    const confirmed = window.confirm(\r\n        \"Do you really want to delete this event?\"\r\n    );\r\n    if (confirmed) {\r\n        try {\r\n            await collection.doc(event.id).delete();\r\n            $(`#${event.id}`).remove();\r\n            closeModal();\r\n        } catch (error) {\r\n            $(\"#errors\").text(error.message);\r\n        }\r\n    }\r\n}\r\n\r\nfunction copyEvent(event) {\r\n    if (mode != MODE.UPDATE) return;\r\n    closeModal();\r\n    mode = MODE.CREATE;\r\n    const eventCopy = {\r\n        title: \"Copy of \" + event.title,\r\n        start: event.start,\r\n        end: event.end,\r\n        date: event.date,\r\n        description: event.description,\r\n        color: event.color,\r\n        allDay: event.allDay,\r\n    };\r\n    openModal(eventCopy);\r\n}\r\n\r\nfunction showEvent(event) {\r\n    if (\r\n        event.date < dateString(weekStart) ||\r\n        event.date > dateString(weekEnd)\r\n    ) {\r\n        $(`#${event.id}`).remove();\r\n        return;\r\n    }\r\n\r\n    let eventElement;\r\n\r\n    if ($(`#${event.id}`).length) {\r\n        eventElement = $(`#${event.id}`);\r\n    } else {\r\n        eventElement = $(\"<div></div>\")\r\n            .addClass(\"event\")\r\n            .attr(\"id\", event.id)\r\n            .click(() => clickEvent(event));\r\n    }\r\n\r\n    const h = slotHeight;\r\n    const dayIndex = getDayIndex(new Date(event.date));\r\n\r\n    if (!event.allDay) {\r\n        const startHour = parseInt(event.start.substring(0, 2));\r\n        const endHour = parseInt(event.end.substring(0, 2));\r\n        const startMinutes = parseInt(event.start.substring(3, 5));\r\n        const endMinutes = parseInt(event.end.substring(3, 5));\r\n\r\n        const duration =\r\n            (new Date(`${event.date}T${event.end}`).getTime() -\r\n                new Date(`${event.date}T${event.start}`).getTime()) /\r\n            (1000 * 60);\r\n\r\n        eventElement\r\n            .removeClass(\"allDay\")\r\n            .text(event.title)\r\n            .css(\r\n                \"top\",\r\n                (startHour + startMinutes / 60) * h + 1 + \"px\"\r\n            )\r\n            .css(\r\n                \"bottom\",\r\n                24 * h - (endHour + endMinutes / 60) * h + 2 + \"px\"\r\n            )\r\n            .css(\"backgroundColor\", `var(--color-${event.color})`)\r\n            .appendTo(`.day[data-dayIndex=${dayIndex}]`);\r\n\r\n        if (duration < 45) {\r\n            eventElement\r\n                .removeClass(\"shortEvent\")\r\n                .addClass(\"veryShortEvent\");\r\n        } else if (duration < 59) {\r\n            eventElement\r\n                .removeClass(\"veryShortEvent\")\r\n                .addClass(\"shortEvent\");\r\n        } else {\r\n            eventElement\r\n                .removeClass(\"shortEvent\")\r\n                .removeClass(\"veryShortEvent\");\r\n        }\r\n    } else {\r\n        eventElement\r\n            .addClass(\"allDay\")\r\n            .text(event.title)\r\n            .css(\"backgroundColor\", `var(--color-${event.color})`)\r\n            .appendTo(\r\n                `.columnHeader[data-dayIndex=${dayIndex}] .allDaySection`\r\n            );\r\n    }\r\n}\r\n\r\nfunction clickEvent(event) {\r\n    if (mode != MODE.VIEW) return;\r\n    mode = MODE.UPDATE;\r\n    openModal(event);\r\n}\r\n\r\nasync function validateEvent(event) {\r\n    if (event.allDay) return true;\r\n    const newStart = $(\"#eventStart\").val();\r\n    const newEnd = $(\"#eventEnd\").val();\r\n    const newDate = $(\"#eventDate\").val();\r\n    const changedTime =\r\n        newStart != event.start ||\r\n        newEnd != event.end ||\r\n        newDate != event.date;\r\n\r\n    if (changedTime) {\r\n        const eventsOnNewDate = await collection\r\n            .where(\"date\", \"==\", newDate)\r\n            .get();\r\n\r\n        let collidingEvent = null;\r\n\r\n        eventsOnNewDate.forEach((doc) => {\r\n            const otherId = doc.id;\r\n            const other = doc.data();\r\n            if (\r\n                !other.allDay &&\r\n                otherId != event.id &&\r\n                other.end > newStart &&\r\n                other.start < newEnd\r\n            ) {\r\n                collidingEvent = other;\r\n            }\r\n        });\r\n        if (collidingEvent) {\r\n            $(\"#errors\").text(\r\n                `This collides with the event '${collidingEvent.title}'` +\r\n                    `(${collidingEvent.start} - ${collidingEvent.end}).`\r\n            );\r\n            return false;\r\n        }\r\n    }\r\n\r\n    const duration =\r\n        (new Date(`${newDate}T${newEnd}`).getTime() -\r\n            new Date(`${newDate}T${newStart}`).getTime()) /\r\n        (1000 * 60);\r\n\r\n    if (duration < 0) {\r\n        $(\"#errors\").text(\"The start cannot be after the end.\");\r\n        return false;\r\n    } else if (duration < 30) {\r\n        $(\"#errors\").text(\"Events should be at least 30 minutes.\");\r\n        return false;\r\n    }\r\n    return true;\r\n}\r\n","function dateString(date) {\r\n    return `${date.getFullYear()}-${(date.getMonth() + 1)\r\n        .toString()\r\n        .padStart(2, \"0\")}-${date\r\n        .getDate()\r\n        .toString()\r\n        .padStart(2, \"0\")}`;\r\n}\r\n\r\nfunction getDayIndex(date) {\r\n    const falseIndex = date.getDay();\r\n    return falseIndex == 0 ? 6 : falseIndex - 1;\r\n}\r\n\r\nconst dayInMillis = 1000 * 60 * 60 * 24;\r\n\r\nfunction addDays(date, number) {\r\n    return new Date(date.getTime() + number * dayInMillis);\r\n}\r\n","function openModal(event) {\r\n    $(\"#modalTitle\").text(\r\n        mode == MODE.UPDATE\r\n            ? \"Update your event\"\r\n            : \"Create a new event\"\r\n    );\r\n    $(\"#eventTitle\").val(event.title);\r\n    $(\"#eventDate\").val(event.date);\r\n    $(\"#eventStart\").val(event.start);\r\n    $(\"#eventEnd\").val(event.end);\r\n    $(\"#eventDescription\").val(event.description);\r\n    $(\"#allDayCheckBox\").prop(\"checked\", event.allDay);\r\n    if (event.allDay) {\r\n        $(\"#timeLabel, #timeInputs\").hide();\r\n    } else {\r\n        $(\"#timeLabel, #timeInputs\").show();\r\n    }\r\n    $(\".color\").removeClass(\"active\");\r\n    $(`.color[data-color=${event.color}]`).addClass(\"active\");\r\n    if (mode == MODE.UPDATE) {\r\n        $(\"#submitButton\").val(\"Update\");\r\n        $(\"#deleteButton\")\r\n            .show()\r\n            .off(\"click\")\r\n            .click(() => deleteEvent(event));\r\n        $(\"#copyButton\")\r\n            .show()\r\n            .off(\"click\")\r\n            .click(() => copyEvent(event));\r\n    } else if (mode == MODE.CREATE) {\r\n        $(\"#submitButton\").val(\"Create\");\r\n        $(\"#deleteButton, #copyButton\").hide();\r\n    }\r\n    $(\"#modalContainer\").fadeIn(200).css(\"display\", \"flex\");\r\n    $(\"#eventModal\")\r\n        .off(\"submit\")\r\n        .submit((e) => {\r\n            e.preventDefault();\r\n            submitModal(event);\r\n        });\r\n}\r\n\r\nfunction closeModal() {\r\n    $(\"#modalContainer\").fadeOut(200);\r\n    $(\"#errors\").text(\"\");\r\n    mode = MODE.VIEW;\r\n}\r\n\r\nasync function submitModal(event) {\r\n    const isValid = await validateEvent(event);\r\n    if (!isValid) return;\r\n    if (mode == MODE.CREATE) {\r\n        await createEvent(event);\r\n    } else if (mode == MODE.UPDATE) {\r\n        await updateEvent(event);\r\n    }\r\n}\r\n","let user,\r\n    collection,\r\n    mode,\r\n    display,\r\n    weekOffset,\r\n    slotHeight,\r\n    weekStart,\r\n    weekEnd,\r\n    listener,\r\n    currentDayIndex;\r\n\r\nconst MODE = {\r\n    VIEW: 1,\r\n    UPDATE: 2,\r\n    CREATE: 3,\r\n};\r\n\r\nconst DISPLAY = {\r\n    DAY: 1,\r\n    WEEK: 2,\r\n};\r\n\r\n$(() => {\r\n    firebase.auth().onAuthStateChanged((firebaseUser) => {\r\n        if (\r\n            !firebaseUser ||\r\n            (firebaseUser && !firebaseUser.emailVerified)\r\n        ) {\r\n            window.location.href = \"./index.html\";\r\n        } else {\r\n            user = firebaseUser;\r\n            setupCalendar();\r\n        }\r\n    });\r\n});\r\n\r\nfunction setupCalendar() {\r\n    setupVariables();\r\n    detectDisplay();\r\n    showEmail();\r\n    setupTimes();\r\n    setupDays();\r\n    calculateCurrentWeek();\r\n    showWeek();\r\n    listenForUpdates();\r\n    setupControls();\r\n}\r\n\r\nfunction setupVariables() {\r\n    collection = database.collection(user.uid);\r\n    mode = MODE.VIEW;\r\n    display = DISPLAY.WEEK;\r\n    weekOffset = 0;\r\n    slotHeight = 30;\r\n    weekStart = null;\r\n    weekEnd = null;\r\n    listener = null;\r\n    currentDayIndex = getDayIndex(new Date());\r\n}\r\n\r\nfunction detectDisplay() {\r\n    if (window.innerWidth < 900) {\r\n        switchToDayDisplay();\r\n    }\r\n    $(\"#calendar\").fadeIn();\r\n}\r\n\r\nfunction showEmail() {\r\n    $(\"#emailDisplay\").text(user.email);\r\n}\r\n\r\nfunction setupTimes() {\r\n    for (let hour = 0; hour < 24; hour++) {\r\n        const time = $(\"<div></div>\")\r\n            .attr(\"data-hour\", hour)\r\n            .addClass(\"time\")\r\n            .appendTo(\".dayTime\");\r\n        if (hour > 0)\r\n            $(\"<span></span>\").text(`${hour}:00`).appendTo(time);\r\n    }\r\n    $(\"#calendar\").scrollTop(7 * slotHeight);\r\n}\r\n\r\nfunction setupDays() {\r\n    $(\".day\").each(function () {\r\n        const day = $(this);\r\n        const dayIndex = parseInt(day.attr(\"data-dayIndex\"));\r\n        $(\"<div></div>\").addClass(\"allDaySection\").appendTo(day);\r\n        for (let hour = 0; hour < 24; hour++) {\r\n            $(\"<div></div>\")\r\n                .attr(\"data-hour\", hour)\r\n                .appendTo(day)\r\n                .addClass(\"slot\")\r\n                .on(\"click\", () => handleClick(hour, dayIndex))\r\n                .hover(\r\n                    () =>\r\n                        $(`.time[data-hour=${hour}]`).addClass(\r\n                            \"currentTime\"\r\n                        ),\r\n                    () => $(\".time\").removeClass(\"currentTime\")\r\n                );\r\n        }\r\n    });\r\n}\r\n\r\nfunction handleClick(hour, dayIndex) {\r\n    if (mode != MODE.VIEW) return;\r\n    mode = MODE.CREATE;\r\n    const start = hour.toString().padStart(2, \"0\") + \":00\";\r\n    const end =\r\n        hour < 23\r\n            ? (hour + 1).toString().padStart(2, \"0\") + \":00\"\r\n            : hour.toString().padStart(2, \"0\") + \":59\";\r\n\r\n    const date = dateString(addDays(weekStart, dayIndex));\r\n    const event = {\r\n        start,\r\n        end,\r\n        date,\r\n        title: \"\",\r\n        description: \"\",\r\n        color: \"red\",\r\n        allDay: false,\r\n    };\r\n    openModal(event);\r\n}\r\n\r\nfunction calculateCurrentWeek() {\r\n    const now = new Date();\r\n    weekStart = addDays(now, -getDayIndex(now));\r\n    weekEnd = addDays(weekStart, 6);\r\n}\r\n\r\nfunction showWeek() {\r\n    const options = {\r\n        month: \"2-digit\",\r\n        day: \"2-digit\",\r\n        year: \"numeric\",\r\n    };\r\n    $(\"#weekStartDisplay\").text(\r\n        weekStart.toLocaleDateString(undefined, options)\r\n    );\r\n    $(\"#weekEndDisplay\").text(\r\n        weekEnd.toLocaleDateString(undefined, options)\r\n    );\r\n\r\n    for (let dayIndex = 0; dayIndex < 7; dayIndex++) {\r\n        const date = addDays(weekStart, dayIndex);\r\n        const display = date.toLocaleDateString(undefined, {\r\n            month: \"2-digit\",\r\n            day: \"2-digit\",\r\n        });\r\n        $(`.columnHeader[data-dayIndex=${dayIndex}] .date`).text(\r\n            display\r\n        );\r\n    }\r\n    if (weekOffset == 0) {\r\n        showCurrentDay();\r\n    } else {\r\n        hideCurrentDay();\r\n    }\r\n}\r\n\r\nfunction showCurrentDay() {\r\n    const now = new Date();\r\n    const dayIndex = getDayIndex(now);\r\n    $(`.columnHeader[data-dayIndex=${dayIndex}]`).addClass(\r\n        \"currentDay\"\r\n    );\r\n}\r\n\r\nfunction hideCurrentDay() {\r\n    $(\".columnHeader\").removeClass(\"currentDay\");\r\n}\r\n\r\nfunction listenForUpdates() {\r\n    listener = collection\r\n        .where(\"date\", \">=\", dateString(weekStart))\r\n        .where(\"date\", \"<=\", dateString(weekEnd))\r\n        .onSnapshot((snap) => {\r\n            $(\".event\").remove();\r\n            snap.forEach((doc) => {\r\n                const event = doc.data();\r\n                event.id = doc.id;\r\n                showEvent(event);\r\n            });\r\n        });\r\n}\r\n"]}