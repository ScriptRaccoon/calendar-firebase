{"version":3,"sources":["controls.js","event.js","helper.js","modal.js","setup.js"],"names":["setupControls","$","click","changeWeek","toggleDisplay","addNewEvent","trashCalendar","logout","closeModal","changeColor","changeCurrentDay","change","toggleTimes","async","number","weekOffset","weekStart","addDays","weekEnd","loadEvents","showWeek","listener","listenForUpdates","dayIndex","mode","MODE","VIEW","CREATE","display","DISPLAY","SINGLE_DAY","currentDayIndex","openModal","start","end","date","dateString","title","description","color","allDay","window","confirm","snap","collection","get","forEach","doc","id","delete","remove","error","alert","message","removeClass","this","addClass","firebase","auth","signOut","then","location","href","catch","toggleClass","WEEK","switchToSingleDayDisplay","switchToWeekDisplay","attr","direction","toggle","createEvent","event","readEvent","eventRef","add","text","updateEvent","update","val","prop","deleteEvent","copyEvent","UPDATE","showEvent","let","eventElement","length","clickEvent","startHour","endHour","startMinutes","endMinutes","duration","h","slotHeight","getDayIndex","Date","css","appendTo","parseInt","substring","getTime","validateEvent","newStart","newEnd","newDate","eventsOnNewDate","where","collidingEvent","otherId","other","data","getFullYear","getMonth","toString","padStart","getDate","falseIndex","getDay","dayInMillis","hide","show","off","fadeIn","submit","e","preventDefault","submitModal","fadeOut","user","setupCalendar","setupVariables","detectDisplay","showEmail","setupTimes","setupDays","calculateCurrentWeek","database","uid","innerWidth","email","hour","time","scrollTop","each","day","on","handleClick","hover","now","options","month","year","toLocaleDateString","undefined","highlightToday","highlight","onSnapshot","events","snapShot","push","onAuthStateChanged","firebaseUser","emailVerified"],"mappings":"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","file":"calendar.js","sourcesContent":["function setupControls() {\r\n    $(\"#nextWeekButton\").click(() => changeWeek(1));\r\n    $(\"#prevWeekButton\").click(() => changeWeek(-1));\r\n    $(\"#displayButton\").click(toggleDisplay);\r\n    $(\"#addButton\").click(addNewEvent);\r\n    $(\"#trashButton\").click(trashCalendar);\r\n    $(\"#logoutButton\").click(logout);\r\n    $(\"#cancelButton\").click(closeModal);\r\n    $(\".color\").click(changeColor);\r\n    $(\".columnHeader .fa-chevron-right\").click(() =>\r\n        changeCurrentDay(+1)\r\n    );\r\n    $(\".columnHeader .fa-chevron-left\").click(() =>\r\n        changeCurrentDay(-1)\r\n    );\r\n    $(\"#allDayCheckBox\").change(toggleTimes);\r\n}\r\n\r\nasync function changeWeek(number) {\r\n    weekOffset += number;\r\n    weekStart = addDays(weekStart, 7 * number);\r\n    weekEnd = addDays(weekEnd, 7 * number);\r\n    await loadEvents();\r\n    showWeek();\r\n    if (listener) listener();\r\n    listenForUpdates();\r\n}\r\n\r\nfunction addNewEvent() {\r\n    if (mode != MODE.VIEW) return;\r\n    mode = MODE.CREATE;\r\n    const dayIndex =\r\n        display == DISPLAY.SINGLE_DAY ? currentDayIndex : 0;\r\n    const event = {\r\n        start: \"12:00\",\r\n        end: \"13:00\",\r\n        date: dateString(addDays(weekStart, dayIndex)),\r\n        title: \"\",\r\n        description: \"\",\r\n        color: \"red\",\r\n        allDay: false,\r\n    };\r\n    openModal(event);\r\n}\r\n\r\nasync function trashCalendar() {\r\n    if (mode != MODE.VIEW) return;\r\n    const confirmed = window.confirm(\r\n        \"This will delete all the events in your calendar!\\n\" +\r\n            \"This cannot be undone. Are you sure?\"\r\n    );\r\n    if (confirmed) {\r\n        try {\r\n            const snap = await collection.get();\r\n            snap.forEach((doc) => {\r\n                collection.doc(doc.id).delete();\r\n                $(`#${doc.id}`).remove();\r\n            });\r\n        } catch (error) {\r\n            window.alert(error.message);\r\n        }\r\n    }\r\n}\r\n\r\nfunction changeColor() {\r\n    $(\".color\").removeClass(\"active\");\r\n    $(this).addClass(\"active\");\r\n}\r\n\r\nfunction logout() {\r\n    firebase\r\n        .auth()\r\n        .signOut()\r\n        .then(() => {\r\n            window.location.href = \"./index.html\";\r\n        })\r\n        .catch((error) => {\r\n            window.alert(error.message);\r\n        });\r\n}\r\n\r\nfunction toggleDisplay() {\r\n    $(\"#displayButton\")\r\n        .toggleClass(\"fa-calendar-day\")\r\n        .toggleClass(\"fa-calendar-week\");\r\n    $(\"#calendar\").toggleClass(\"singleDay\");\r\n    if (display == DISPLAY.WEEK) {\r\n        switchToSingleDayDisplay();\r\n    } else {\r\n        switchToWeekDisplay();\r\n    }\r\n}\r\n\r\nfunction switchToSingleDayDisplay() {\r\n    display = DISPLAY.SINGLE_DAY;\r\n    $(\"#calendar\").addClass(\"singleDay\");\r\n    $(\"#displayButton\")\r\n        .removeClass(\"fa-calendar-week\")\r\n        .addClass(\"fa-calendar-day\");\r\n    $(\"#displayButton\").attr(\"title\", \"Change to week view\");\r\n    $(`.day[data-dayIndex=\"${currentDayIndex}\"`).addClass(\"current\");\r\n    $(`.columnHeader[data-dayIndex=\"${currentDayIndex}\"`).addClass(\r\n        \"current\"\r\n    );\r\n}\r\n\r\nfunction switchToWeekDisplay() {\r\n    display = DISPLAY.WEEK;\r\n    $(\"#calendar\").removeClass(\"singleDay\");\r\n    $(\"#displayButton\")\r\n        .removeClass(\"fa-calendar-day\")\r\n        .addClass(\"fa-calendar-week\");\r\n\r\n    $(\"#displayButton\").attr(\"title\", \"Change to day view\");\r\n    $(\".day, .columnHeader\").removeClass(\"current\");\r\n}\r\n\r\nfunction changeCurrentDay(direction) {\r\n    if (display == DISPLAY.WEEK) return;\r\n    $(\".day, .columnHeader\").removeClass(\"current\");\r\n    currentDayIndex += direction;\r\n    if (currentDayIndex < 0) {\r\n        changeWeek(-1);\r\n        currentDayIndex = 6;\r\n    } else if (currentDayIndex >= 7) {\r\n        changeWeek(+1);\r\n        currentDayIndex = 0;\r\n    }\r\n    $(`.day[data-dayIndex=\"${currentDayIndex}\"`).addClass(\"current\");\r\n    $(`.columnHeader[data-dayIndex=\"${currentDayIndex}\"`).addClass(\r\n        \"current\"\r\n    );\r\n}\r\n\r\nfunction toggleTimes() {\r\n    $(\"#timeLabel\").toggle();\r\n    $(\"#timeInputs\").toggle();\r\n}\r\n","async function createEvent(event) {\r\n    readEvent(event);\r\n    try {\r\n        const eventRef = await collection.add(event);\r\n        event.id = eventRef.id;\r\n        closeModal();\r\n    } catch (error) {\r\n        $(\"#errors\").text(error.message);\r\n    }\r\n}\r\n\r\nasync function updateEvent(event) {\r\n    readEvent(event);\r\n    try {\r\n        await collection.doc(event.id).update({\r\n            title: event.title,\r\n            start: event.start,\r\n            end: event.end,\r\n            date: event.date,\r\n            description: event.description,\r\n            color: event.color,\r\n            allDay: event.allDay,\r\n        });\r\n        closeModal();\r\n    } catch (error) {\r\n        $(\"#errors\").text(error.message);\r\n    }\r\n}\r\n\r\nfunction readEvent(event) {\r\n    event.title = $(\"#eventTitle\").val();\r\n    event.start = $(\"#eventStart\").val();\r\n    event.end = $(\"#eventEnd\").val();\r\n    event.date = $(\"#eventDate\").val();\r\n    event.description = $(\"#eventDescription\").val();\r\n    event.allDay = $(\"#allDayCheckBox\").prop(\"checked\");\r\n    event.color = $(\".color.active\").attr(\"data-color\");\r\n}\r\n\r\nasync function deleteEvent(event) {\r\n    const confirmed = window.confirm(\r\n        \"Do you really want to delete this event?\"\r\n    );\r\n    if (confirmed) {\r\n        try {\r\n            await collection.doc(event.id).delete();\r\n            $(`#${event.id}`).remove();\r\n            closeModal();\r\n        } catch (error) {\r\n            $(\"#errors\").text(error.message);\r\n        }\r\n    }\r\n}\r\n\r\nfunction copyEvent(event) {\r\n    if (mode != MODE.UPDATE) return;\r\n    closeModal();\r\n    mode = MODE.CREATE;\r\n    const eventCopy = {\r\n        title: \"Copy of \" + event.title,\r\n        start: event.start,\r\n        end: event.end,\r\n        date: event.date,\r\n        description: event.description,\r\n        color: event.color,\r\n        allDay: event.allDay,\r\n    };\r\n    openModal(eventCopy);\r\n}\r\n\r\nfunction showEvent(event) {\r\n    if (\r\n        event.date < dateString(weekStart) ||\r\n        event.date > dateString(weekEnd)\r\n    ) {\r\n        $(`#${event.id}`).remove();\r\n        return;\r\n    }\r\n\r\n    let eventElement;\r\n\r\n    if ($(`#${event.id}`).length) {\r\n        eventElement = $(`#${event.id}`);\r\n    } else {\r\n        eventElement = $(\"<div></div>\")\r\n            .addClass(\"event\")\r\n            .attr(\"id\", event.id)\r\n            .click(() => clickEvent(event));\r\n    }\r\n\r\n    const h = slotHeight;\r\n    const dayIndex = getDayIndex(new Date(event.date));\r\n\r\n    if (!event.allDay) {\r\n        const startHour = parseInt(event.start.substring(0, 2));\r\n        const endHour = parseInt(event.end.substring(0, 2));\r\n        const startMinutes = parseInt(event.start.substring(3, 5));\r\n        const endMinutes = parseInt(event.end.substring(3, 5));\r\n\r\n        const duration =\r\n            (new Date(`${event.date}T${event.end}`).getTime() -\r\n                new Date(`${event.date}T${event.start}`).getTime()) /\r\n            (1000 * 60);\r\n\r\n        eventElement\r\n            .removeClass(\"allDay\")\r\n            .text(event.title)\r\n            .css(\r\n                \"top\",\r\n                (startHour + startMinutes / 60) * h + 1 + \"px\"\r\n            )\r\n            .css(\r\n                \"bottom\",\r\n                24 * h - (endHour + endMinutes / 60) * h + 2 + \"px\"\r\n            )\r\n            .css(\"backgroundColor\", `var(--color-${event.color})`)\r\n            .appendTo(`.day[data-dayIndex=${dayIndex}]`);\r\n\r\n        if (duration < 45) {\r\n            eventElement\r\n                .removeClass(\"shortEvent\")\r\n                .addClass(\"veryShortEvent\");\r\n        } else if (duration < 59) {\r\n            eventElement\r\n                .removeClass(\"veryShortEvent\")\r\n                .addClass(\"shortEvent\");\r\n        } else {\r\n            eventElement\r\n                .removeClass(\"shortEvent\")\r\n                .removeClass(\"veryShortEvent\");\r\n        }\r\n    } else {\r\n        eventElement\r\n            .addClass(\"allDay\")\r\n            .text(event.title)\r\n            .css(\"backgroundColor\", `var(--color-${event.color})`)\r\n            .appendTo(\r\n                `.columnHeader[data-dayIndex=${dayIndex}] .allDaySection`\r\n            );\r\n    }\r\n}\r\n\r\nfunction clickEvent(event) {\r\n    if (mode != MODE.VIEW) return;\r\n    mode = MODE.UPDATE;\r\n    openModal(event);\r\n}\r\n\r\nasync function validateEvent(event) {\r\n    if (event.allDay) return true;\r\n    const newStart = $(\"#eventStart\").val();\r\n    const newEnd = $(\"#eventEnd\").val();\r\n    const newDate = $(\"#eventDate\").val();\r\n    const changedTime =\r\n        newStart != event.start ||\r\n        newEnd != event.end ||\r\n        newDate != event.date;\r\n\r\n    if (changedTime) {\r\n        const eventsOnNewDate = await collection\r\n            .where(\"date\", \"==\", newDate)\r\n            .get();\r\n\r\n        let collidingEvent = null;\r\n\r\n        eventsOnNewDate.forEach((doc) => {\r\n            const otherId = doc.id;\r\n            const other = doc.data();\r\n            if (\r\n                !other.allDay &&\r\n                otherId != event.id &&\r\n                other.end > newStart &&\r\n                other.start < newEnd\r\n            ) {\r\n                collidingEvent = other;\r\n            }\r\n        });\r\n        if (collidingEvent) {\r\n            $(\"#errors\").text(\r\n                `This collides with the event '${collidingEvent.title}'` +\r\n                    `(${collidingEvent.start} - ${collidingEvent.end}).`\r\n            );\r\n            return false;\r\n        }\r\n    }\r\n\r\n    const duration =\r\n        (new Date(`${newDate}T${newEnd}`).getTime() -\r\n            new Date(`${newDate}T${newStart}`).getTime()) /\r\n        (1000 * 60);\r\n\r\n    if (duration < 0) {\r\n        $(\"#errors\").text(\"The start cannot be after the end.\");\r\n        return false;\r\n    } else if (duration < 30) {\r\n        $(\"#errors\").text(\"Events should be at least 30 minutes.\");\r\n        return false;\r\n    }\r\n    return true;\r\n}\r\n","function dateString(date) {\r\n    return `${date.getFullYear()}-${(date.getMonth() + 1)\r\n        .toString()\r\n        .padStart(2, \"0\")}-${date\r\n        .getDate()\r\n        .toString()\r\n        .padStart(2, \"0\")}`;\r\n}\r\n\r\nfunction getDayIndex(date) {\r\n    const falseIndex = date.getDay();\r\n    return falseIndex == 0 ? 6 : falseIndex - 1;\r\n}\r\n\r\nconst dayInMillis = 1000 * 60 * 60 * 24;\r\n\r\nfunction addDays(date, number) {\r\n    return new Date(date.getTime() + number * dayInMillis);\r\n}\r\n","function openModal(event) {\r\n    $(\"#modalTitle\").text(\r\n        mode == MODE.UPDATE\r\n            ? \"Update your event\"\r\n            : \"Create a new event\"\r\n    );\r\n    $(\"#eventTitle\").val(event.title);\r\n    $(\"#eventDate\").val(event.date);\r\n    $(\"#eventStart\").val(event.start);\r\n    $(\"#eventEnd\").val(event.end);\r\n    $(\"#eventDescription\").val(event.description);\r\n    $(\"#allDayCheckBox\").prop(\"checked\", event.allDay);\r\n    if (event.allDay) {\r\n        $(\"#timeLabel, #timeInputs\").hide();\r\n    } else {\r\n        $(\"#timeLabel, #timeInputs\").show();\r\n    }\r\n    $(\".color\").removeClass(\"active\");\r\n    $(`.color[data-color=${event.color}]`).addClass(\"active\");\r\n    if (mode == MODE.UPDATE) {\r\n        $(\"#submitButton\").val(\"Update\");\r\n        $(\"#deleteButton\")\r\n            .show()\r\n            .off(\"click\")\r\n            .click(() => deleteEvent(event));\r\n        $(\"#copyButton\")\r\n            .show()\r\n            .off(\"click\")\r\n            .click(() => copyEvent(event));\r\n    } else if (mode == MODE.CREATE) {\r\n        $(\"#submitButton\").val(\"Create\");\r\n        $(\"#deleteButton, #copyButton\").hide();\r\n    }\r\n    $(\"#modalContainer\").fadeIn(200).css(\"display\", \"flex\");\r\n    $(\"#eventModal\")\r\n        .off(\"submit\")\r\n        .submit((e) => {\r\n            e.preventDefault();\r\n            submitModal(event);\r\n        });\r\n}\r\n\r\nfunction closeModal() {\r\n    $(\"#modalContainer\").fadeOut(200);\r\n    $(\"#errors\").text(\"\");\r\n    mode = MODE.VIEW;\r\n}\r\n\r\nasync function submitModal(event) {\r\n    const isValid = await validateEvent(event);\r\n    if (!isValid) return;\r\n    if (mode == MODE.CREATE) {\r\n        await createEvent(event);\r\n    } else if (mode == MODE.UPDATE) {\r\n        await updateEvent(event);\r\n    }\r\n}\r\n","let user,\r\n    collection,\r\n    mode,\r\n    display,\r\n    weekOffset,\r\n    slotHeight,\r\n    weekStart,\r\n    weekEnd,\r\n    listener,\r\n    currentDayIndex;\r\n\r\nconst MODE = {\r\n    VIEW: 1,\r\n    UPDATE: 2,\r\n    CREATE: 3,\r\n};\r\n\r\nconst DISPLAY = {\r\n    SINGLE_DAY: 1,\r\n    WEEK: 2,\r\n};\r\n\r\n$(() => {\r\n    firebase.auth().onAuthStateChanged((firebaseUser) => {\r\n        if (\r\n            !firebaseUser ||\r\n            (firebaseUser && !firebaseUser.emailVerified)\r\n        ) {\r\n            window.location.href = \"./index.html\";\r\n        } else {\r\n            user = firebaseUser;\r\n            setupCalendar();\r\n        }\r\n    });\r\n});\r\n\r\nfunction setupCalendar() {\r\n    setupVariables();\r\n    detectDisplay();\r\n    showEmail();\r\n    setupTimes();\r\n    setupDays();\r\n    calculateCurrentWeek();\r\n    showWeek();\r\n    listenForUpdates();\r\n    setupControls();\r\n}\r\n\r\nfunction setupVariables() {\r\n    collection = database.collection(user.uid);\r\n    mode = MODE.VIEW;\r\n    display = DISPLAY.WEEK;\r\n    weekOffset = 0;\r\n    slotHeight = 30;\r\n    weekStart = null;\r\n    weekEnd = null;\r\n    listener = null;\r\n    currentDayIndex = getDayIndex(new Date());\r\n}\r\n\r\nfunction detectDisplay() {\r\n    if (window.innerWidth < 900) {\r\n        switchToSingleDayDisplay();\r\n    }\r\n    $(\"#calendar\").fadeIn();\r\n}\r\n\r\nfunction showEmail() {\r\n    $(\"#emailDisplay\").text(user.email);\r\n}\r\n\r\nfunction setupTimes() {\r\n    for (let hour = 0; hour < 24; hour++) {\r\n        const time = $(\"<div></div>\")\r\n            .attr(\"data-hour\", hour)\r\n            .addClass(\"time\")\r\n            .appendTo(\".dayTime\");\r\n        if (hour > 0)\r\n            $(\"<span></span>\").text(`${hour}:00`).appendTo(time);\r\n    }\r\n    $(\"#calendar\").scrollTop(7 * slotHeight);\r\n}\r\n\r\nfunction setupDays() {\r\n    $(\".day\").each(function () {\r\n        const day = $(this);\r\n        const dayIndex = parseInt(day.attr(\"data-dayIndex\"));\r\n        $(\"<div></div>\").addClass(\"allDaySection\").appendTo(day);\r\n        for (let hour = 0; hour < 24; hour++) {\r\n            $(\"<div></div>\")\r\n                .attr(\"data-hour\", hour)\r\n                .appendTo(day)\r\n                .addClass(\"slot\")\r\n                .on(\"click\", () => handleClick(hour, dayIndex))\r\n                .hover(\r\n                    () =>\r\n                        $(`.time[data-hour=${hour}]`).addClass(\r\n                            \"currentTime\"\r\n                        ),\r\n                    () => $(\".time\").removeClass(\"currentTime\")\r\n                );\r\n        }\r\n    });\r\n}\r\n\r\nfunction handleClick(hour, dayIndex) {\r\n    if (mode != MODE.VIEW) return;\r\n    mode = MODE.CREATE;\r\n    const start = hour.toString().padStart(2, \"0\") + \":00\";\r\n    const end =\r\n        hour < 23\r\n            ? (hour + 1).toString().padStart(2, \"0\") + \":00\"\r\n            : hour.toString().padStart(2, \"0\") + \":59\";\r\n\r\n    const date = dateString(addDays(weekStart, dayIndex));\r\n    const event = {\r\n        start,\r\n        end,\r\n        date,\r\n        title: \"\",\r\n        description: \"\",\r\n        color: \"red\",\r\n        allDay: false,\r\n    };\r\n    openModal(event);\r\n}\r\n\r\nfunction calculateCurrentWeek() {\r\n    const now = new Date();\r\n    weekStart = addDays(now, -getDayIndex(now));\r\n    weekEnd = addDays(weekStart, 6);\r\n}\r\n\r\nfunction showWeek() {\r\n    const options = {\r\n        month: \"2-digit\",\r\n        day: \"2-digit\",\r\n        year: \"numeric\",\r\n    };\r\n    $(\"#weekStartDisplay\").text(\r\n        weekStart.toLocaleDateString(undefined, options)\r\n    );\r\n    $(\"#weekEndDisplay\").text(\r\n        weekEnd.toLocaleDateString(undefined, options)\r\n    );\r\n\r\n    for (let dayIndex = 0; dayIndex < 7; dayIndex++) {\r\n        const date = addDays(weekStart, dayIndex);\r\n        const display = date.toLocaleDateString(undefined, {\r\n            month: \"2-digit\",\r\n            day: \"2-digit\",\r\n        });\r\n        $(`.columnHeader[data-dayIndex=${dayIndex}] .date`).text(\r\n            display\r\n        );\r\n    }\r\n    if (weekOffset == 0) {\r\n        highlightToday(true);\r\n    } else {\r\n        highlightToday(false);\r\n    }\r\n}\r\n\r\nfunction highlightToday(highlight) {\r\n    if (highlight) {\r\n        const now = new Date();\r\n        const dayIndex = getDayIndex(now);\r\n        $(`.columnHeader[data-dayIndex=${dayIndex}]`).addClass(\r\n            \"today\"\r\n        );\r\n    } else {\r\n        $(\".columnHeader\").removeClass(\"today\");\r\n    }\r\n}\r\n\r\nfunction listenForUpdates() {\r\n    listener = collection\r\n        .where(\"date\", \">=\", dateString(weekStart))\r\n        .where(\"date\", \"<=\", dateString(weekEnd))\r\n        .onSnapshot((snap) => {\r\n            $(\".event\").remove();\r\n            snap.forEach((doc) => {\r\n                const event = doc.data();\r\n                event.id = doc.id;\r\n                showEvent(event);\r\n            });\r\n        });\r\n}\r\n\r\nasync function loadEvents() {\r\n    const events = [];\r\n    const snapShot = await collection\r\n        .where(\"date\", \">=\", dateString(weekStart))\r\n        .where(\"date\", \"<=\", dateString(weekEnd))\r\n        .get();\r\n    snapShot.forEach((doc) => {\r\n        const event = doc.data();\r\n        event.id = doc.id;\r\n        events.push(event);\r\n    });\r\n    $(\".event\").remove();\r\n    for (const event of events) {\r\n        showEvent(event);\r\n    }\r\n}\r\n"]}